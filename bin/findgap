#!/usr/bin/env python

##########################################################################
##                       Sequence Concat
##	Author: Tyghe Vallard						                        
##	Date: 6/5/2012							                            
##	Version: 1.0							                            
##	Description:							                            
##      This script will locate gaps in an alignment
##      file.
##########################################################################

import sys
import os
import re
from optparse import OptionParser,OptionGroup

try:
    from wrairlib import *
    from wrairlib.parser.exceptions import *
    from wrairlib.exceptions1 import *
    from wrairlib.fff.fffprojectdir import *
    from wrairlib.fff.mappingproject import MappingProject
    from wrairlib.util import *
except ImportError:
    print "Is pyWrairLib installed?"
    sys.exit( -1 )

try:
    from Bio import SeqIO
except ImportError:
    print "Is BioPython installed?"
    sys.exit( -1 )

# Project imports
from coverage.gap import FindGaps

################ Script Functions #######################
def set_opts( parser ):
    parser.add_option( "-d", dest="directory", help="The 454 pipeline directory to find gaps for." )
    parser.add_option( "-r", dest="reference", help="Which reference to use." )
    parser.add_option( "--test", dest="test", action="store_true", help="Run the tests for this script" )
    options,args = parser.parse_args()
    if not (options.directory and options.reference) and not options.test:
        parser.print_help()
        parser.error( "Need to specify the project directory and reference" )
    return options

# Run The script if this script is executed
if __name__ == '__main__':
    parser = OptionParser()
    options = set_opts( parser )
    if options.test:
        import doctest
        doctest.testmod()
    else:
        fg = FindGaps( options.directory, options.reference )
        print fg.output_csv( )
